<pbs-navigation>
  <pbs-breadcrumb ng-show="!$ctrl.runWizard"
    title="'Select Users'"></pbs-breadcrumb>
  <pbs-breadcrumb ng-show="$ctrl.runWizard"
    title="'Select Users'"
    ng-click="$ctrl.runWizard = false"></pbs-breadcrumb>
  <pbs-breadcrumb ng-show="$ctrl.runWizard"
    title="'Wizard'"></pbs-breadcrumb>
</pbs-navigation>
<pbs-block title="Select Users"
  ng-show="!$ctrl.runWizard">
  <pbs-columns>
    <pbs-column>
      <p class="subtitle">Run Wizard</p>
      <button class="button is-info"
        ng-click="$ctrl.runWizard = true">Run User Wizard</button>
    </pbs-column>
    <pbs-column>
      <p class="subtitle">Upload CSV</p>
      <pbs-input-file on-upload="$ctrl.upload(file)"
        mode="text"></pbs-input-file>
    </pbs-column>
  </pbs-columns>
  <br>
  <pbs-spinner loading="$ctrl.loadingTasks">
    <p class="subtitle">
      Select from Recent Tasks
    </p>
    <input type="search"
      placeholder="Search"
      class="input margin-bottom"
      ng-model="search"
      ng-show="false">
    <table pbs-table>
      <thead>
        <tr>
          <th>User</th>
          <th>Task</th>
          <th>Count</th>
          <th>Date</th>
        </tr>
      </thead>
      <tfoot>
        <tr ng-if="results.length < 1">
          <td colspan="4">No Tasks Found
            <span ng-if="search">for {{ search }}</span>
          </td>
        </tr>
      </tfoot>
      <tbody>
        <tr class="hover with-tooltip"
          ng-repeat="task in $ctrl.tasks | filter:search as results track by task.id"
          ng-click="$ctrl.select(task)"
          title="{{ task.userList }}">
          <td>{{ task.userId }}</td>
          <td>{{ task.type }}</td>
          <td>{{ task.data.length }}</td>
          <td>{{ task.updatedAt | pbsDate:'relative' }}</td>
        </tr>
      </tbody>
    </table>
  </pbs-spinner>
</pbs-block>
<pbs-wizard ng-show="$ctrl.runWizard"
  on-ready="$ctrl.wizardReady($event)"
  on-complete="$ctrl.wizardComplete($event)">
  <pbs-wizard-step label="Service Provider">
    <bulk-select-service-provider-id on-update="$ctrl.onUpdateServiceProviderId($event)">
    </bulk-select-service-provider-id>
  </pbs-wizard-step>
  <pbs-wizard-step label="Group">
    <bulk-select-group-id service-provider-id="$ctrl.data.serviceProviderId"
      on-update="$ctrl.onUpdateGroupId($event)">
    </bulk-select-group-id>
  </pbs-wizard-step>
  <pbs-wizard-step label="Users">
    <bulk-select-users service-provider-id="$ctrl.data.serviceProviderId"
      group-id="$ctrl.data.groupId"
      users="$ctrl.data.users"
      on-update="$ctrl.onUpdateUsers($event)">
    </bulk-select-users>
  </pbs-wizard-step>
</pbs-wizard>
</div>
